!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("@angular/common"),require("@angular/router"),require("rxjs/observable/fromEvent")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@angular/router","rxjs/observable/fromEvent"],n):n(e["meepo-idesign"]={},e.ng.core,e.ng.common,e.ng.router,e.Rx.Observable)}(this,function(e,n,t,o,i){"use strict";function r(e){return Array.prototype.concat.apply([],e)}var s=new n.InjectionToken("DESIGN_LIBRARYS"),a=function(){function e(){}return e.prototype.get=function(e){},e.prototype.save=function(e,n){},e}();a.decorators=[{type:n.Injectable}],a.ctorParameters=function(){return[]};var p=new n.InjectionToken("DESIGN_COMPONENTS"),c=function(){function e(e){this.props=[],this.pageProps=[],this.settingProps={},this.historyKey="historyKey",this.historys=[],this.props=r(e);try{this.backToHistory()}catch(n){localStorage.clear()}}return e.prototype.getPropsByName=function(e){var n;return this.props.forEach(function(t){e===t.name&&(n=t)}),n},e.prototype.addPropByName=function(e){var n=this.getPropsByName(e);this.pageProps.push(this.deepCopy(n)),this.updateHistory()},e.prototype.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},e.prototype.isGuid=function(e){return e.indexOf("guid_")>-1},e.prototype.trimGuid=function(e){return e.replace("guid_","")},e.prototype.removePropsByUid=function(e,n){n=n||this.pageProps,e=this.trimGuid(e);for(var t=0,o=0;o<n.length;o++){var i=n[o];if(i.uuid===e){t=o+1;break}i.children&&i.children.length>0&&this.removePropsByUid(e,i.children)}console.log("remove",t),t>0&&(this.pageProps.splice(t-1,1),this.updateHistory())},e.prototype.getHistory=function(){var e=localStorage.getItem(this.historyKey);return e?JSON.parse(e):[]},e.prototype.updateHistory=function(){this.historys.unshift({name:(new Date).toISOString(),data:this.pageProps}),this.historys.length>50&&(this.historys=this.historys.splice(this.historys.length,this.historys.length-50)),localStorage.setItem(this.historyKey,JSON.stringify(this.historys))},e.prototype.backToHistory=function(e){void 0===e&&(e=null),e||(e=this.getHistory()[0]),this.pageProps=e.data},e}();c.decorators=[{type:n.Injectable}],c.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Inject,args:[p]}]}]};var d=function(){function e(e){this.components=[],this.components=r(e),console.log("DesignLibraryService",this.components)}return e.prototype.get=function(e){var n;return this.components.map(function(t){t[e]&&(n=t[e])}),n},e}();d.decorators=[{type:n.Injectable}],d.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Inject,args:[s]}]}]};var l=new n.InjectionToken("DRAG_DROP_ALL"),g=function(){function e(e,n,t,o,i,r,s){this._viewContainerRef=e,this._template=n,this.differs=t,this.librarys=o,this.props=i,this.render=r,this.dragDropAll=s,this.instances=[],this.viewContainerRef=e}return e.prototype.ngDoCheck=function(){var e=this;if(this._differ){var n=this._differ.diff(this.ngComponent);n&&n.forEachOperation(function(n,t,o){if(null==n.previousIndex)e.createComponent(n,o);else if(null==o)e._viewContainerRef.remove(t);else{var i=e._viewContainerRef.get(t);e._viewContainerRef.move(i,o)}})}},e.prototype.createComponent=function(e,t){var o=this;try{var i=e.item;if(i){var r=void 0,s=this.librarys.get(i.name);r=this.ngComponentPreview?s.view:s.setting;var a=this.viewContainerRef.parentInjector,p=(this.moduleRef?this.moduleRef.componentFactoryResolver:a.get(n.ComponentFactoryResolver)).resolveComponentFactory(r),c=this.viewContainerRef.createComponent(p,t,a);i.props&&(c.instance.props=i.props),i.state&&(c.instance.state=i.state),c.instance.onClick.subscribe(function(e){o.ngComponentClick&&o.ngComponentClick(i)}),c.instance.setClass(this.ngComponentClass),c.instance.setStyle(this.ngComponentStyle),(this.ngComponentDrag||this.dragDropAll)&&this.setDrage(c.instance),(this.ngComponentDrop||this.dragDropAll)&&this.setDrop(c.instance),i.uuid=c.instance.guid;var d=new f(c.instance.guid,i);this.instances.push(d)}}catch(l){console.log((this.ngComponentPreview?"preview":"setting")+" is not fond",e),console.dir(l)}},e.prototype.ngOnChanges=function(e){if(this.viewContainerRef.clear(),"ngComponent"in e){var n=e.ngComponent.currentValue;if(n&&!this._differ)try{this._differ=this.differs.find(n).create()}catch(t){}}},e.prototype.setDrage=function(e){e.setAttribute({draggable:!0});var n=e.ele.nativeElement;i.fromEvent(n,"dragstart").subscribe(function(n){e.guid,n.dataTransfer.setData("name","guid_"+e.guid)}),i.fromEvent(n,"dragend").subscribe(function(e){})},e.prototype.isGuid=function(e){return e.indexOf("guid_")>-1},e.prototype.trimGuid=function(e){return e.replace("guid_","")},e.prototype.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},e.prototype.setDrop=function(e){var n=this,t=e.ele.nativeElement;i.fromEvent(t,"drop").subscribe(function(t){t.preventDefault(),t.stopPropagation();var o=t.dataTransfer.getData("name"),i=n.trimGuid(o);if(n.isGuid(o)){if(i!==e.guid){(r=n.getInstanceProps(i))&&e.props.children.push(n.deepCopy(r))}}else{var r=n.props.getPropsByName(o);e.props.children=e.props.children||[],e.props.children.push(n.deepCopy(r))}}),i.fromEvent(t,"dragleave").subscribe(function(e){n.render.removeStyle(t,"dashed"),e.preventDefault(),e.stopPropagation()}),i.fromEvent(t,"dragover").subscribe(function(e){n.render.setStyle(t,"dashed","1px lodash red"),e.preventDefault(),e.stopPropagation()})},e.prototype.getInstanceProps=function(e){var n;return this.instances.map(function(t){t.guid===e&&(n=t.props)}),n},e}();g.decorators=[{type:n.Directive,args:[{selector:"[ngComponent]"}]}],g.ctorParameters=function(){return[{type:n.ViewContainerRef},{type:n.TemplateRef},{type:n.IterableDiffers},{type:d},{type:c},{type:n.Renderer2},{type:undefined,decorators:[{type:n.Inject,args:[l]}]}]},g.propDecorators={ngComponent:[{type:n.Input}],ngComponentPreview:[{type:n.Input}],ngComponentState:[{type:n.Input}],ngComponentClass:[{type:n.Input}],ngComponentStyle:[{type:n.Input}],ngComponentDrag:[{type:n.Input}],ngComponentDrop:[{type:n.Input}],ngComponentClick:[{type:n.Input}]};var f=function(){return function(e,n){this.guid=e,this.props=n}}(),u=function(){function e(){}return e.forRoot=function(n,t){return void 0===t&&(t=!1),{ngModule:e,providers:[{provide:s,useValue:n,multi:!0},{provide:l,useValue:t}]}},e}();u.decorators=[{type:n.NgModule,args:[{imports:[],exports:[g],declarations:[g],providers:[a,d,c]}]}],u.ctorParameters=function(){return[]};var m=function(){function e(){this._setting=!0}return e.prototype.ngOnInit=function(){},e.prototype.setSetting=function(e,n){this.item=e,this.instance=n},e}();m.decorators=[{type:n.Component,args:[{selector:"design-setting",template:'\n\n      <ng-container *ngComponent="[item];instance: instance;"></ng-container>\n\n      <div class="meepo-design-setting-empty" *ngIf="!item">\n          请选择要编辑的页面元素\n      </div>\n    '}]}],m.ctorParameters=function(){return[]},m.propDecorators={_setting:[{type:n.HostBinding,args:["class.meepo-design-setting"]}]};var h=function(){function e(e){var t=this;this.props=e,this._preview=!0,this.doClick=new n.EventEmitter,this.directives={name:"device-iphone-8 device-gold",color:"",src:"./assets/img/bg-03.jpg",type:"image"},this.onClick=function(e,n){t.doClick.emit({props:e,instance:n})},this.isOpen=!1}return e.prototype.ngOnInit=function(){},e.prototype._showMore=function(e){console.log("显示操作提示")},e.prototype.addComponent=function(e){this.props.addPropByName(e)},e.prototype.removeComponent=function(e){this.props.removePropsByUid(e)},e}();h.decorators=[{type:n.Component,args:[{selector:"design-preview",template:'\n      <div class="meepo-design-preview-deletor" canDrop (canDropChange)="removeComponent($event)">\n          垃圾桶，将废弃组件拖入此间！\n      </div>\n      <div class="device device-iphone-8" [ngClass]="directives.name">\n          <div class="device-frame">\n              <div class="meepo-design-preview-container device-content" canDrop (canDropChange)="addComponent($event)">\n                  <ng-container *ngComponent="\n                      props.pageProps;\n                      preview: true;\n                      click: onClick;\n                      class: {\'editing\':true};\n                      drag: true;\n                      drop: true;\n                  "></ng-container>\n              </div>\n          </div>\n          <div class="device-stripe"></div>\n          <div class="device-header"></div>\n          <div class="device-sensors"></div>\n          <div class="device-btns"></div>\n          <div class="device-power"></div>\n          <div class="device-home"></div>\n      </div>\n    '}]}],h.ctorParameters=function(){return[{type:c}]},h.propDecorators={_preview:[{type:n.HostBinding,args:["class.meepo-design-preview"]}],doClick:[{type:n.Output}]};var y=function(){function e(e){this.props=e,this._library=!0,this.components=[]}return e.prototype.ngOnInit=function(){this.components=this.props.props},e}();y.decorators=[{type:n.Component,args:[{selector:"design-library",template:'\n      <ng-container *ngFor="let item of components">\n          <div class="grid-item" [canDrag]="item.name">\n              <span>{{item.title}}</span>\n          </div>\n      </ng-container>\n      <div style="clear: both;"></div>\n      <div style="height:88px;"></div>\n    '}]}],y.ctorParameters=function(){return[{type:c}]},y.propDecorators={_library:[{type:n.HostBinding,args:["class.meepo-design-library"]}]};var v=function(){function e(e){this.props=e,this._history=!0}return e.prototype.ngOnInit=function(){},e.prototype.getLocal=function(){return this.props.getHistory()},e.prototype.backToHistory=function(e){this.props.backToHistory(e)},e}();v.decorators=[{type:n.Component,args:[{selector:"design-history",template:'\n      <ul>\n          <li  (click)="backToHistory(item)" *ngFor="let item of props.historys">{{item.name}}</li>\n      </ul>\n    '}]}],v.ctorParameters=function(){return[{type:c}]},v.propDecorators={_history:[{type:n.HostBinding,args:["class.meepo-design-history"]}]};var b=new n.InjectionToken("DESIGN_PAGES"),x=function(){function e(e){this.pages=[],this.pages=e}return e.prototype.ngOnInit=function(){},e}();x.decorators=[{type:n.Component,args:[{selector:"design-pages",template:'\n      <ul>\n          <li *ngFor="let page of pages">\n              {{page.title}}\n          </li>\n      </ul>\n    '}]}],x.ctorParameters=function(){return[{type:Array,decorators:[{type:n.Inject,args:[b]}]}]};var w=function(){function e(e,n){this.props=e,this.router=n,this._design=!0,this.activeHistory=!1}return e.prototype.ngOnInit=function(){},e.prototype.setSetting=function(e){this._setting.setSetting(e.props,e.instance)},e.prototype.saveToHistory=function(){this.props.updateHistory()},e.prototype.previewToHistory=function(){this.router.navigate(["preview"])},e.prototype.postToHistory=function(){},e}();w.decorators=[{type:n.Component,args:[{selector:"design",template:'\n      <div class="meepo-design-left">\n          <ul class="meepo-design-left-header">\n              <li [class.active]="activeHistory" (click)="activeHistory = true">历史记录</li>\n              <li [class.active]="!activeHistory" (click)="activeHistory = false">页面管理</li>\n          </ul>\n          <div class="meepo-design-left-container">\n              <design-history *ngIf="activeHistory"></design-history>\n              <design-pages *ngIf="!activeHistory"></design-pages>\n          </div>\n      </div>\n      <design-library></design-library>\n      <design-preview (doClick)="setSetting($event)"></design-preview>\n      <design-setting></design-setting>\n\n      <div class="meepo-design-footer">\n          <a href="javascript:;" (click)="saveToHistory()" class="meepo-design-footer-save">保存</a>\n          <a href="javascript:;" (click)="previewToHistory()" class="meepo-design-footer-preview">预览</a>\n          <a href="javascript:;" (click)="postToHistory()" class="meepo-design-footer-post">生成</a>\n      </div>\n    ',styles:['\n      .meepo-design {\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        height: 100%;\n        width: 100%; }\n        .meepo-design .editing {\n          cursor: pointer; }\n        .meepo-design-history, .meepo-design-library, .meepo-design-preview, .meepo-design-setting, .meepo-design-pages {\n          min-height: 80px;\n          position: relative; }\n        .meepo-design-left-container {\n          display: -webkit-box;\n          display: -ms-flexbox;\n          display: flex;\n          -webkit-box-orient: vertical;\n          -webkit-box-direction: normal;\n              -ms-flex-direction: column;\n                  flex-direction: column;\n          height: calc(100% - 44px);\n          overflow: auto;\n          width: 250px;\n          background: #efefef; }\n        .meepo-design-left-header {\n          list-style: none;\n          margin: 0px;\n          padding: 0px;\n          display: -webkit-box;\n          display: -ms-flexbox;\n          display: flex;\n          -webkit-box-orient: horizontal;\n          -webkit-box-direction: normal;\n              -ms-flex-direction: row;\n                  flex-direction: row; }\n          .meepo-design-left-header li {\n            text-align: center;\n            -webkit-box-flex: 1;\n                -ms-flex: 1;\n                    flex: 1;\n            height: 44px;\n            line-height: 44px;\n            margin: 0px; }\n            .meepo-design-left-header li.active {\n              background: #db4804;\n              color: #fff; }\n        .meepo-design-pages {\n          display: block;\n          background: #efefef;\n          width: 250px;\n          max-height: 100%;\n          overflow: auto; }\n        .meepo-design-history {\n          display: block;\n          background: #efefef;\n          width: 250px;\n          max-height: 100%;\n          overflow: auto; }\n          .meepo-design-history ul {\n            list-style: none;\n            margin: 0px;\n            padding: 0px; }\n            .meepo-design-history ul li {\n              line-height: 30px;\n              background: #efefef;\n              cursor: pointer; }\n              .meepo-design-history ul li:hover {\n                opacity: .8;\n                background: #fff; }\n        .meepo-design-library {\n          background: white;\n          width: 200px;\n          display: block;\n          overflow: auto; }\n          .meepo-design-library:after {\n            clear: both;\n            content: " "; }\n          .meepo-design-library .grid-item {\n            float: left;\n            width: 50%;\n            text-align: center;\n            line-height: 44px;\n            background: #efefef;\n            border: 1px solid #fff;\n            cursor: pointer; }\n            .meepo-design-library .grid-item:hover {\n              background: #ccc; }\n        .meepo-design-preview {\n          display: block;\n          background: #f3f3f3;\n          width: 400px;\n          max-height: 100%;\n          overflow: auto; }\n          .meepo-design-preview .device {\n            margin: 0 auto; }\n          .meepo-design-preview-deletor {\n            height: 120px;\n            display: -webkit-box;\n            display: -ms-flexbox;\n            display: flex;\n            -webkit-box-orient: horizontal;\n            -webkit-box-direction: normal;\n                -ms-flex-direction: row;\n                    flex-direction: row;\n            -webkit-box-pack: center;\n                -ms-flex-pack: center;\n                    justify-content: center;\n            -webkit-box-align: center;\n                -ms-flex-align: center;\n                    align-items: center;\n            background: gray;\n            color: #fff;\n            margin-bottom: 10px;\n            margin-left: 10px;\n            margin-right: 10px; }\n          .meepo-design-preview-iphone {\n            margin: 0 auto; }\n          .meepo-design-preview-container {\n            height: 100%;\n            position: absolute;\n            top: 0px;\n            left: 0px;\n            right: 0px;\n            bottom: 0px; }\n          .meepo-design-preview .device-content {\n            overflow: auto;\n            width: 100%;\n            height: 100%; }\n        .meepo-design-setting {\n          display: block;\n          background: #efefef;\n          -webkit-box-flex: 1;\n              -ms-flex: 1;\n                  flex: 1;\n          padding: 0 10px;\n          border-left: 10px solid #fff; }\n          .meepo-design-setting-empty {\n            height: 100%;\n            display: -webkit-box;\n            display: -ms-flexbox;\n            display: flex;\n            -webkit-box-orient: vertical;\n            -webkit-box-direction: normal;\n                -ms-flex-direction: column;\n                    flex-direction: column;\n            -webkit-box-pack: center;\n                -ms-flex-pack: center;\n                    justify-content: center;\n            -webkit-box-align: center;\n                -ms-flex-align: center;\n                    align-items: center;\n            font-size: .8em;\n            color: gray; }\n        .meepo-design-footer {\n          position: fixed;\n          bottom: 0px;\n          left: 0px;\n          right: 0px;\n          height: 60px;\n          display: -webkit-box;\n          display: -ms-flexbox;\n          display: flex;\n          -webkit-box-orient: horizontal;\n          -webkit-box-direction: normal;\n              -ms-flex-direction: row;\n                  flex-direction: row;\n          -webkit-box-pack: end;\n              -ms-flex-pack: end;\n                  justify-content: flex-end;\n          -webkit-box-align: center;\n              -ms-flex-align: center;\n                  align-items: center;\n          background: rgba(0, 0, 0, 0.5); }\n          .meepo-design-footer-save, .meepo-design-footer-preview, .meepo-design-footer-post {\n            width: 8em;\n            text-align: center;\n            height: 100%;\n            line-height: 60px; }\n          .meepo-design-footer-save {\n            background: #c74a06; }\n          .meepo-design-footer-preview {\n            background: #004fbf; }\n          .meepo-design-footer-post {\n            background: #0d7355; }\n          .meepo-design-footer a {\n            text-decoration: none;\n            color: #fff; }\n            .meepo-design-footer a:hover {\n              text-decoration: none; }\n    '],encapsulation:n.ViewEncapsulation.None}]}],w.ctorParameters=function(){return[{type:c},{type:o.Router}]},w.propDecorators={_design:[{type:n.HostBinding,args:["class.meepo-design"]}],_setting:[{type:n.ViewChild,args:[m]}],_library:[{type:n.ViewChild,args:[y]}],_preview:[{type:n.ViewChild,args:[h]}],_history:[{type:n.ViewChild,args:[v]}],_pages:[{type:n.ViewChild,args:[x]}]};var C=function(){function e(e,t){this.ele=e,this.render=t,this.canDropChange=new n.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;i.fromEvent(this.ele.nativeElement,"drop").subscribe(function(n){n.preventDefault();var t=n.dataTransfer.getData("name");e.canDropChange.emit(t)}),i.fromEvent(this.ele.nativeElement,"dragover").subscribe(function(e){e.preventDefault()})},e}();C.decorators=[{type:n.Directive,args:[{selector:"[canDrop]"}]}],C.ctorParameters=function(){return[{type:n.ElementRef},{type:n.Renderer2}]},C.propDecorators={canDropChange:[{type:n.Output}],canDrop:[{type:n.Input}]};var k=function(){function e(e,t,o){this.ele=e,this.render=t,this.view=o,this._drop=!0,this.canDragChange=new n.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;i.fromEvent(this.ele.nativeElement,"dragstart").subscribe(function(n){n.dataTransfer.setData("name",e.canDrag)}),i.fromEvent(this.ele.nativeElement,"dragend").subscribe(function(n){e.canDragChange.emit(e.canDrag)})},e}();k.decorators=[{type:n.Directive,args:[{selector:"[canDrag]"}]}],k.ctorParameters=function(){return[{type:n.ElementRef},{type:n.Renderer2},{type:n.ViewContainerRef}]},k.propDecorators={_drop:[{type:n.HostBinding,args:["attr.draggable"]}],canDrag:[{type:n.Input}],canDragChange:[{type:n.Output}]};var D=function(){function e(){}return e.forRoot=function(n){return void 0===n&&(n=[]),{ngModule:e,providers:[{provide:b,useValue:n}]}},e}();D.decorators=[{type:n.NgModule,args:[{imports:[t.CommonModule,o.RouterModule.forChild([{path:"design",component:w}]),u.forRoot([])],exports:[y,w,v,h,m,C,k,x],declarations:[y,w,v,h,m,C,k,x],providers:[]}]}],D.ctorParameters=function(){return[]},e.IDesignModule=D,e.ɵe=b,e.ɵg=w,e.ɵd=v,e.ɵc=y,e.ɵf=x,e.ɵb=h,e.ɵa=m,e.ɵi=k,e.ɵh=C,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=meepo-idesign.umd.min.js.map
