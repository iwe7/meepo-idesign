!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("@angular/common"),require("@angular/router"),require("rxjs/observable/fromEvent"),require("rxjs/Subject")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@angular/router","rxjs/observable/fromEvent","rxjs/Subject"],n):n(e["meepo-idesign"]={},e.ng.core,e.ng.common,e.ng.router,e.Rx.Observable,e.Rx)}(this,function(e,n,t,i,o,r){"use strict";var s=new n.InjectionToken("DESIGN_LIBRARYS"),a=function(){function e(e){var n;this.components=[],this.components=(n=e,Array.prototype.concat.apply([],n))}return e.prototype.get=function(e){var n;return this.components.map(function(t){t[e]&&(n=t[e])}),n},e}();a.decorators=[{type:n.Injectable}],a.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Inject,args:[s]}]}]};var p=function(){function e(e,n,t,i){this._viewContainerRef=e,this._template=n,this.differs=t,this.librarys=i,this.instances=[],this.viewContainerRef=e}return e.prototype.ngDoCheck=function(){var e=this;if(this._differ){var n=this._differ.diff(this.ngComponent);n&&n.forEachOperation(function(n,t,i){if(null==n.previousIndex)e.createComponent(n,i);else if(null==i)e._viewContainerRef.remove(t);else{var o=e._viewContainerRef.get(t);e._viewContainerRef.move(o,i)}})}},e.prototype.createComponent=function(e,t){var i=this;try{var o=e.item,r=void 0,s=this.librarys.get(o.name);r=this.ngComponentPreview?s.view:s.setting;var a=this.viewContainerRef.parentInjector,p=(this.moduleRef?this.moduleRef.componentFactoryResolver:a.get(n.ComponentFactoryResolver)).resolveComponentFactory(r),l=this.viewContainerRef.createComponent(p,t,a);l.instance.props=o.props,l.instance.onClick.subscribe(function(e){i.ngComponentClick&&i.ngComponentClick(o)}),l.instance.setClass(this.ngComponentClass),l.instance.setStyle(this.ngComponentStyle),this.setDrage(l.instance),this.setDrop(l.instance),o.uuid=l.instance.guid;var d=new c(l.instance.guid,o);this.instances.push(d)}catch(g){}},e.prototype.ngOnChanges=function(e){if(this.viewContainerRef.clear(),"ngComponent"in e){var n=e.ngComponent.currentValue;if(n&&!this._differ)try{this._differ=this.differs.find(n).create()}catch(t){}}},e.prototype.setDrage=function(e){e.setAttribute({draggable:!0});var n=e.ele.nativeElement;o.fromEvent(n,"dragstart").subscribe(function(n){e.guid,n.dataTransfer.setData("name",e.guid)}),o.fromEvent(n,"dragleave").subscribe(function(e){}),o.fromEvent(n,"dragend").subscribe(function(e){})},e.prototype.setDrop=function(e){var n=this,t=e.ele.nativeElement;o.fromEvent(t,"drop").subscribe(function(t){t.preventDefault(),t.stopPropagation();var i=t.dataTransfer.getData("name");if(e.guid!==i){var o=n.getInstanceProps(i);o&&e.props.children.push(o)}}),o.fromEvent(t,"dragover").subscribe(function(e){t.style.bor,e.preventDefault(),e.stopPropagation()})},e.prototype.getInstanceProps=function(e){var n;return this.instances.map(function(t){t.guid===e&&(n=t.props)}),n},e}();p.decorators=[{type:n.Directive,args:[{selector:"[ngComponent]"}]}],p.ctorParameters=function(){return[{type:n.ViewContainerRef},{type:n.TemplateRef},{type:n.IterableDiffers},{type:a}]},p.propDecorators={ngComponent:[{type:n.Input}],ngComponentPreview:[{type:n.Input}],ngComponentState:[{type:n.Input}],ngComponentClass:[{type:n.Input}],ngComponentStyle:[{type:n.Input}],ngComponentDrag:[{type:n.Input}],ngComponentDrop:[{type:n.Input}],ngComponentClick:[{type:n.Input}]};var c=function(){return function(e,n){this.guid=e,this.props=n}}(),l=function(){return function(){}}();l.decorators=[{type:n.NgModule,args:[{imports:[],exports:[p],declarations:[p],providers:[]}]}],l.ctorParameters=function(){return[]};var d="historyKey",g=new n.InjectionToken("DESIGN_COMPONENTS");var f=function(){function e(e,n,t){var i;this.injector=e,this.library=t,this._historys=[],this.history$=new r.Subject,this.data=[],this.data$=new r.Subject,this.allComponents=[],this.previewComponents=[],this.previewComponents$=new r.Subject,this.allComponents=(i=n,Array.prototype.concat.apply([],i))}return Object.defineProperty(e.prototype,"historys",{get:function(){return this._historys||[]},set:function(e){this._historys=e},enumerable:!0,configurable:!0}),e.prototype.removeComponentByUuid=function(e){var n;this.previewComponents.map(function(t,i){t.uuid===e&&(n=i)}),this.previewComponents.splice(n,1),this.previewComponents$.next(this.previewComponents)},e.prototype.getComponentByName=function(e){var n;return this.allComponents.forEach(function(t){e===t.name&&(n=t)}),n},e.prototype.getHistory=function(){var e=localStorage.getItem(d);return e?JSON.parse(e):[]},e.prototype.updateHistory=function(e){this.historys=e,this.historys.length>50&&(this.historys=this.historys.splice(this.historys.length,this.historys.length-50)),localStorage.setItem(d,JSON.stringify(this.historys)),this.history$.next(this.historys)},e.prototype.backToHistory=function(e){void 0===e&&(e=null),e||(e=this.getHistory()[0]),this.data=e.data,this.data$.next(this.data)},e}();f.decorators=[{type:n.Injectable}],f.ctorParameters=function(){return[{type:n.Injector},{type:undefined,decorators:[{type:n.Inject,args:[g]}]},{type:a}]};var u=function(){function e(){this._setting=!0}return e.prototype.ngOnInit=function(){},e.prototype.setSetting=function(e){this.item=e},e}();u.decorators=[{type:n.Component,args:[{selector:"design-setting",template:'\n\n      <ng-container *ngComponent="[item]"></ng-container>\n\n      <div class="meepo-design-setting-empty" *ngIf="!item">\n          请选择要编辑的页面元素\n      </div>\n    '}]}],u.ctorParameters=function(){return[]},u.propDecorators={_setting:[{type:n.HostBinding,args:["class.meepo-design-setting"]}]};var h=function(){function e(e){var t=this;this.history=e,this._preview=!0,this.doClick=new n.EventEmitter,this.components=[],this.directives={name:"device-iphone-8 device-gold",color:"",src:"./assets/img/bg-03.jpg",type:"image"},this.onClick=function(e){t.doClick.emit(e)},this.isOpen=!1,this.history.data$.subscribe(function(e){t.components=e})}return e.prototype.ngOnInit=function(){var e=this;try{this.history.backToHistory(),this.historys=this.history.historys}catch(n){localStorage.clear()}this.history.previewComponents=this.components,this.history.previewComponents$.subscribe(function(n){console.log(n),e.components=n})},e.prototype._showMore=function(e){console.log("显示操作提示")},e.prototype.addComponent=function(e){try{var n=this.history.getComponentByName(e);n&&(this.components.push((t=n,JSON.parse(JSON.stringify(t)))),this.updateCache())}catch(i){console.log("undefined err",i)}var t},e.prototype.removeComponent=function(e){var n=0;this.components.map(function(t,i){t.uuid===e&&(n=i)}),this.components.splice(n,1),this.updateCache()},e.prototype.updateCache=function(){var e=new Date,n=JSON.stringify(this.components),t={name:e.toISOString(),data:JSON.parse(n)};this.historys=this.historys||[],this.historys.unshift(t),this.history.updateHistory(this.historys)},e}();h.decorators=[{type:n.Component,args:[{selector:"design-preview",template:'\n      <div class="meepo-design-preview-deletor">\n          垃圾桶，将废弃组件拖入此间！\n      </div>\n      <div class="device device-iphone-8" [ngClass]="directives.name">\n          <div class="device-frame">\n              <div class="meepo-design-preview-container device-content" canDrop (canDropChange)="addComponent($event)">\n                  <ng-container *ngComponent="components;preview: true;click: onClick;class: {\'editing\':true}"></ng-container>\n              </div>\n          </div>\n          <div class="device-stripe"></div>\n          <div class="device-header"></div>\n          <div class="device-sensors"></div>\n          <div class="device-btns"></div>\n          <div class="device-power"></div>\n          <div class="device-home"></div>\n      </div>\n    '}]}],h.ctorParameters=function(){return[{type:f}]},h.propDecorators={_preview:[{type:n.HostBinding,args:["class.meepo-design-preview"]}],doClick:[{type:n.Output}]};var m=function(){function e(e){this.history=e,this._library=!0,this.components=[]}return e.prototype.ngOnInit=function(){this.components=this.history.allComponents},e}();m.decorators=[{type:n.Component,args:[{selector:"design-library",template:'\n      <ng-container *ngFor="let item of components">\n          <div class="grid-item" [canDrag]="item.name">\n              <span>{{item.title}}</span>\n          </div>\n      </ng-container>\n      <div style="clear: both;"></div>\n      <div style="height:88px;"></div>\n    '}]}],m.ctorParameters=function(){return[{type:f}]},m.propDecorators={_library:[{type:n.HostBinding,args:["class.meepo-design-library"]}]};var y=function(){function e(e){this.history=e,this._history=!0,this.items=[],this.items=this.getLocal()}return e.prototype.ngOnInit=function(){var e=this;this.history.history$.subscribe(function(n){e.items=n})},e.prototype.getLocal=function(){return this.history.getHistory()},e.prototype.backToHistory=function(e){this.history.backToHistory(e)},e}();y.decorators=[{type:n.Component,args:[{selector:"design-history",template:'\n      <ul>\n          <li  (click)="backToHistory(item)" *ngFor="let item of items">{{item.name}}</li>\n      </ul>\n    '}]}],y.ctorParameters=function(){return[{type:f}]},y.propDecorators={_history:[{type:n.HostBinding,args:["class.meepo-design-history"]}]};var v=new n.InjectionToken("DESIGN_PAGES"),b=function(){function e(e){this.pages=[],this.pages=e}return e.prototype.ngOnInit=function(){},e}();b.decorators=[{type:n.Component,args:[{selector:"design-pages",template:'\n      <ul>\n          <li *ngFor="let page of pages">\n              {{page.title}}\n          </li>\n      </ul>\n    '}]}],b.ctorParameters=function(){return[{type:Array,decorators:[{type:n.Inject,args:[v]}]}]};var x=function(){function e(e,n){this.history=e,this.router=n,this._design=!0,this.activeHistory=!1}return e.prototype.ngOnInit=function(){},e.prototype.setSetting=function(e){this._setting.setSetting(e)},e.prototype.saveToHistory=function(){this._preview.updateCache()},e.prototype.previewToHistory=function(){this.router.navigate(["preview"])},e.prototype.postToHistory=function(){},e}();x.decorators=[{type:n.Component,args:[{selector:"design",template:'\n      <div class="meepo-design-left">\n          <ul class="meepo-design-left-header">\n              <li [class.active]="activeHistory" (click)="activeHistory = true">历史记录</li>\n              <li [class.active]="!activeHistory" (click)="activeHistory = false">页面管理</li>\n          </ul>\n          <div class="meepo-design-left-container">\n              <design-history *ngIf="activeHistory"></design-history>\n              <design-pages *ngIf="!activeHistory"></design-pages>\n          </div>\n      </div>\n      \x3c!-- <design-library></design-library> --\x3e\n      <design-preview (doClick)="setSetting($event)"></design-preview>\n      <design-setting></design-setting>\n\n      <div class="meepo-design-footer">\n          <a href="javascript:;" (click)="saveToHistory()" class="meepo-design-footer-save">保存</a>\n          <a href="javascript:;" (click)="previewToHistory()" class="meepo-design-footer-preview">预览</a>\n          <a href="javascript:;" (click)="postToHistory()" class="meepo-design-footer-post">生成</a>\n      </div>\n    ',styles:['\n      .meepo-design {\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        height: 100%;\n        width: 100%; }\n        .meepo-design .editing {\n          cursor: pointer; }\n        .meepo-design-history, .meepo-design-library, .meepo-design-preview, .meepo-design-setting, .meepo-design-pages {\n          min-height: 80px;\n          position: relative; }\n        .meepo-design-left-container {\n          display: -webkit-box;\n          display: -ms-flexbox;\n          display: flex;\n          -webkit-box-orient: vertical;\n          -webkit-box-direction: normal;\n              -ms-flex-direction: column;\n                  flex-direction: column;\n          height: calc(100% - 44px);\n          overflow: auto;\n          width: 250px;\n          background: #efefef; }\n        .meepo-design-left-header {\n          list-style: none;\n          margin: 0px;\n          padding: 0px;\n          display: -webkit-box;\n          display: -ms-flexbox;\n          display: flex;\n          -webkit-box-orient: horizontal;\n          -webkit-box-direction: normal;\n              -ms-flex-direction: row;\n                  flex-direction: row; }\n          .meepo-design-left-header li {\n            text-align: center;\n            -webkit-box-flex: 1;\n                -ms-flex: 1;\n                    flex: 1;\n            height: 44px;\n            line-height: 44px;\n            margin: 0px; }\n            .meepo-design-left-header li.active {\n              background: #db4804;\n              color: #fff; }\n        .meepo-design-pages {\n          display: block;\n          background: #efefef;\n          width: 250px;\n          max-height: 100%;\n          overflow: auto; }\n        .meepo-design-history {\n          display: block;\n          background: #efefef;\n          width: 250px;\n          max-height: 100%;\n          overflow: auto; }\n          .meepo-design-history ul {\n            list-style: none;\n            margin: 0px;\n            padding: 0px; }\n            .meepo-design-history ul li {\n              line-height: 30px;\n              background: #efefef;\n              cursor: pointer; }\n              .meepo-design-history ul li:hover {\n                opacity: .8;\n                background: #fff; }\n        .meepo-design-library {\n          background: white;\n          width: 200px;\n          display: block;\n          overflow: auto; }\n          .meepo-design-library:after {\n            clear: both;\n            content: " "; }\n          .meepo-design-library .grid-item {\n            float: left;\n            width: 50%;\n            text-align: center;\n            line-height: 44px;\n            background: #efefef;\n            border: 1px solid #fff;\n            cursor: pointer; }\n            .meepo-design-library .grid-item:hover {\n              background: #ccc; }\n        .meepo-design-preview {\n          display: block;\n          background: #f3f3f3;\n          width: 400px;\n          max-height: 100%;\n          overflow: auto; }\n          .meepo-design-preview .device {\n            margin: 0 auto; }\n          .meepo-design-preview-deletor {\n            height: 120px;\n            display: -webkit-box;\n            display: -ms-flexbox;\n            display: flex;\n            -webkit-box-orient: horizontal;\n            -webkit-box-direction: normal;\n                -ms-flex-direction: row;\n                    flex-direction: row;\n            -webkit-box-pack: center;\n                -ms-flex-pack: center;\n                    justify-content: center;\n            -webkit-box-align: center;\n                -ms-flex-align: center;\n                    align-items: center;\n            background: gray;\n            color: #fff;\n            margin-bottom: 10px;\n            margin-left: 10px;\n            margin-right: 10px; }\n          .meepo-design-preview-iphone {\n            margin: 0 auto; }\n          .meepo-design-preview-container {\n            height: 100%;\n            position: absolute;\n            top: 0px;\n            left: 0px;\n            right: 0px;\n            bottom: 0px; }\n          .meepo-design-preview .device-content {\n            overflow: auto;\n            width: 100%;\n            height: 100%; }\n        .meepo-design-setting {\n          display: block;\n          background: #efefef;\n          -webkit-box-flex: 1;\n              -ms-flex: 1;\n                  flex: 1;\n          padding: 0 10px;\n          border-left: 10px solid #fff; }\n          .meepo-design-setting-empty {\n            height: 100%;\n            display: -webkit-box;\n            display: -ms-flexbox;\n            display: flex;\n            -webkit-box-orient: vertical;\n            -webkit-box-direction: normal;\n                -ms-flex-direction: column;\n                    flex-direction: column;\n            -webkit-box-pack: center;\n                -ms-flex-pack: center;\n                    justify-content: center;\n            -webkit-box-align: center;\n                -ms-flex-align: center;\n                    align-items: center;\n            font-size: .8em;\n            color: gray; }\n        .meepo-design-footer {\n          position: fixed;\n          bottom: 0px;\n          left: 0px;\n          right: 0px;\n          height: 60px;\n          display: -webkit-box;\n          display: -ms-flexbox;\n          display: flex;\n          -webkit-box-orient: horizontal;\n          -webkit-box-direction: normal;\n              -ms-flex-direction: row;\n                  flex-direction: row;\n          -webkit-box-pack: end;\n              -ms-flex-pack: end;\n                  justify-content: flex-end;\n          -webkit-box-align: center;\n              -ms-flex-align: center;\n                  align-items: center;\n          background: rgba(0, 0, 0, 0.5); }\n          .meepo-design-footer-save, .meepo-design-footer-preview, .meepo-design-footer-post {\n            width: 8em;\n            text-align: center;\n            height: 100%;\n            line-height: 60px; }\n          .meepo-design-footer-save {\n            background: #c74a06; }\n          .meepo-design-footer-preview {\n            background: #004fbf; }\n          .meepo-design-footer-post {\n            background: #0d7355; }\n          .meepo-design-footer a {\n            text-decoration: none;\n            color: #fff; }\n            .meepo-design-footer a:hover {\n              text-decoration: none; }\n    '],encapsulation:n.ViewEncapsulation.None}]}],x.ctorParameters=function(){return[{type:f},{type:i.Router}]},x.propDecorators={_design:[{type:n.HostBinding,args:["class.meepo-design"]}],_setting:[{type:n.ViewChild,args:[u]}],_library:[{type:n.ViewChild,args:[m]}],_preview:[{type:n.ViewChild,args:[h]}],_history:[{type:n.ViewChild,args:[y]}],_pages:[{type:n.ViewChild,args:[b]}]};var w=function(){function e(e,t){this.ele=e,this.render=t,this.canDropChange=new n.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;o.fromEvent(this.ele.nativeElement,"drop").subscribe(function(n){n.preventDefault();var t=n.dataTransfer.getData("name");e.canDropChange.emit(t)}),o.fromEvent(this.ele.nativeElement,"dragover").subscribe(function(e){e.preventDefault()})},e}();w.decorators=[{type:n.Directive,args:[{selector:"[canDrop]"}]}],w.ctorParameters=function(){return[{type:n.ElementRef},{type:n.Renderer2}]},w.propDecorators={canDropChange:[{type:n.Output}],canDrop:[{type:n.Input}]};var C=function(){function e(e,t,i){this.ele=e,this.render=t,this.view=i,this._drop=!0,this.canDragChange=new n.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;o.fromEvent(this.ele.nativeElement,"dragstart").subscribe(function(n){n.dataTransfer.setData("name",e.canDrag)}),o.fromEvent(this.ele.nativeElement,"dragend").subscribe(function(n){e.canDragChange.emit(e.canDrag)})},e}();C.decorators=[{type:n.Directive,args:[{selector:"[canDrag]"}]}],C.ctorParameters=function(){return[{type:n.ElementRef},{type:n.Renderer2},{type:n.ViewContainerRef}]},C.propDecorators={_drop:[{type:n.HostBinding,args:["attr.draggable"]}],canDrag:[{type:n.Input}],canDragChange:[{type:n.Output}]};var k=function(){function e(){}return e.forRoot=function(n){return void 0===n&&(n=[]),{ngModule:e,providers:[{provide:v,useValue:n}]}},e}();k.decorators=[{type:n.NgModule,args:[{imports:[t.CommonModule,i.RouterModule.forChild([{path:"design",component:x}]),l],exports:[m,x,y,h,u,w,C,b,l],declarations:[m,x,y,h,u,w,C,b],providers:[f,a]}]}],k.ctorParameters=function(){return[]},e.IDesignModule=k,e.DesignService=f,e.DESIGN_COMPONENTS=g,e.ɵe=v,e.ɵg=x,e.ɵd=y,e.ɵc=m,e.ɵf=b,e.ɵb=h,e.ɵa=u,e.ɵi=C,e.ɵh=w,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=meepo-idesign.umd.min.js.map
