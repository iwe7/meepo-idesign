!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/observable/fromEvent"),require("rxjs/add/operator/switchMap"),require("rxjs/add/operator/map"),require("@angular/forms"),require("@angular/common"),require("rxjs/observable/combineLatest")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/observable/fromEvent","rxjs/add/operator/switchMap","rxjs/add/operator/map","@angular/forms","@angular/common","rxjs/observable/combineLatest"],e):e(t["meepo-idesign-share"]={},t.ng.core,t.Rx.Observable,t.Rx.Observable.prototype,t.Rx.Observable.prototype,t.ng.forms,t.ng.common,t.Rx.Observable)}(this,function(t,e,r,n,o,i,s,p){"use strict";function a(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function u(t){return Array.prototype.concat.apply([],t)}var c=new e.InjectionToken("DESIGN_LIBRARYS"),f=new Map,h=function(){return function(t,e,r){this.guid=t,this.props=e,this.instance=r}}(),d=function(){function t(){}return t.prototype.get=function(t){return f.get(t)},t.prototype.save=function(t,e,r){var n,o=new h(t.guid,e,t);r?((n=f.get(t.guid))?n.view=o:n={setting:null,view:o},f.set(t.guid,n)):((n=f.get(t.guid))?n.setting=o:n={setting:o,view:null},f.set(t.guid,n))},t}();d.decorators=[{type:e.Injectable}],d.ctorParameters=function(){return[]};var l=new e.InjectionToken("DESIGN_COMPONENTS"),g=function(){function t(t,e){this.library=e,this.props=[],this.pageProps=[],this.fathersProps=[],this.historyKey="historyKey",this.historys=[],this.removePosition=[],this.props=u(t);try{this.backToHistory()}catch(r){localStorage.clear()}}return Object.defineProperty(t.prototype,"settingProps",{get:function(){return this._settingProps},set:function(t){var e=this;this._settingProps=t;try{this._settingProps||(this.fathersProps=[]),this.fathers=this.getFather(this.settingProps),this.fathers&&this.fathers.length>0&&(this.fathersProps=[],this.fathers.map(function(t){var r=e.getPropsByUid(t);r&&e.fathersProps.push(r)}))}catch(r){}},enumerable:!0,configurable:!0}),t.prototype.setActiveSettingProps=function(t,e){this.settingProps=t,this.instance&&this.instance.removeClass("is-focus"),this.instance=e,e.addClass("is-focus")},t.prototype.getPropsByName=function(t){var e;return this.props.forEach(function(r){t===r.name&&(e=r)}),e},t.prototype.addPropByName=function(t,e){var r=this.getPropsByName(t),n=this.deepCopy(r);if(n)if(n.uuid);else{n.uuid=a(),n.father=e||"";var o=this.library.get(n.name);n.props=new o["default"],this.pageProps.push(n),this.updateHistory()}},t.prototype.addPropsToInstanceByName=function(t){var e=this.getPropsByName(t);if(e)if(this.instance){(n=this.deepCopy(e)).father=this.instance.guid;var r=this.library.get(n.name);n.props=new r["default"],n.uuid=a(),this.instance.props.children=this.instance.props.children||[],this.instance.props.children.push(n)}else{var n;(n=this.deepCopy(e)).father=null;r=this.library.get(n.name);n.props=new r["default"],n.uuid=a(),this.pageProps.push(n)}},t.prototype.toFatherProps=function(){console.log(this.fathersProps)},t.prototype.deepCopy=function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){console.dir(t)}},t.prototype.isGuid=function(t){return t.indexOf("guid_")>-1},t.prototype.trimGuid=function(t){return t.replace("guid_","")},t.prototype.removePropsByUid=function(t){t=this.trimGuid(t);var e=this.getPropsByUid(t);if(e)if(e.father){var r=this.getPropsByUid(e.father);(n=r.props.children.indexOf(e))>-1&&r.props.children.splice(n,1)}else{var n;(n=this.pageProps.indexOf(e))>-1&&this.pageProps.splice(n,1)}this.updateHistory()},t.prototype.getFather=function(t,e){if(void 0===e&&(e=[]),e.push(t.uuid),t.father){var r=this.getPropsByUid(t.father);r&&(e=this.getFather(r,e))}return e},t.prototype.getPropsByUid=function(t,e){e=e||this.pageProps;for(var r=0;r<e.length;r++){var n=e[r];if(n.uuid+""==t+"")return n;if(n.props.children){var o=this.getPropsByUid(t,n.props.children);if(o)return o}}return!1},t.prototype.getHistory=function(){var t=localStorage.getItem(this.historyKey);if(t){var e=JSON.parse(t);return this.historys=e,e}return[]},t.prototype.updateHistory=function(){this.historys.unshift({name:(new Date).toISOString(),data:this.pageProps}),this.historys.length>50&&(this.historys=this.historys.splice(this.historys.length,this.historys.length-50)),localStorage.setItem(this.historyKey,JSON.stringify(this.historys))},t.prototype.backToHistory=function(t){void 0===t&&(t=null),t||(t=this.getHistory()[0]),this.pageProps=t.data},t}();g.decorators=[{type:e.Injectable}],g.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[l]}]},{type:y}]};var y=function(){function t(t){this.components=[],this.components=u(t)}return t.prototype.get=function(t){var e;return this.components.map(function(r){r[t]&&(e=r[t])}),e},t}();y.decorators=[{type:e.Injectable}],y.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[c]}]}]};var m=new e.InjectionToken("DRAG_DROP_ALL"),v=function(){function t(t,e,r,n,o,i,s,p){this._viewContainerRef=t,this._template=e,this.differs=r,this.librarys=n,this.api=o,this.props=i,this.render=s,this.dragDropAll=p,this.instances=[],this.viewContainerRef=t}return t.prototype.ngDoCheck=function(){var t=this;if(this._differ){var e=this._differ.diff(this.ngComponent);e&&e.forEachOperation(function(e,r,n){if(null==e.previousIndex)t.createComponent(e,n);else if(null==n)t._viewContainerRef.remove(r);else{var o=t._viewContainerRef.get(r);t._viewContainerRef.move(o,n)}})}},t.prototype.createComponent=function(t,r){var n=this;try{var o=t.item;if(o){var i=void 0,s=this.librarys.get(o.name);i=this.ngComponentPreview?s.view:s.setting;var p=this.viewContainerRef.parentInjector,u=(this.moduleRef?this.moduleRef.componentFactoryResolver:p.get(e.ComponentFactoryResolver)).resolveComponentFactory(i),c=this.viewContainerRef.createComponent(u,r,p).instance;o.props&&(c.props=o.props),o.state&&(c.state=o.state),c.onClick.subscribe(function(t){n.ngComponentPreview&&(n.props.setActiveSettingProps(o,c),t.stopPropagation())}),c.setClass(this.ngComponentClass),c.setStyle(this.ngComponentStyle),c.instance=this.ngComponentInstance,(this.ngComponentDrag||this.dragDropAll)&&this.setDrage(c),this.ngComponentDrop||this.dragDropAll,o.uuid?c.guid=o.uuid:o.uuid=c.guid=a(),this.api.save(c,o,this.ngComponentPreview)}}catch(f){console.log((this.ngComponentPreview?"preview":"setting")+" is not fond",t),console.dir(f)}},t.prototype.ngOnChanges=function(t){if(this.viewContainerRef.clear(),"ngComponent"in t){var e=t.ngComponent.currentValue;if(e&&!this._differ)try{this._differ=this.differs.find(e).create()}catch(r){}}},t.prototype.setDrage=function(t){t.setAttribute({draggable:!0});var e=t.ele.nativeElement;r.fromEvent(e,"dragstart").subscribe(function(e){t.guid,e.dataTransfer.setData("name","guid_"+t.guid),e.stopPropagation()}),r.fromEvent(e,"dragend").subscribe(function(t){})},t.prototype.isGuid=function(t){return t.indexOf("guid_")>-1},t.prototype.trimGuid=function(t){return t.replace("guid_","")},t.prototype.deepCopy=function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return console.dir(e),{}}},t.prototype.setDrop=function(t){var e=this,n=t.ele.nativeElement;r.fromEvent(n,"drop").subscribe(function(r){r.preventDefault(),r.stopPropagation();var n=r.dataTransfer.getData("name"),o=e.trimGuid(n);if(e.isGuid(n)){if(o!==t.guid){if(s=e.getInstanceProps(o))(i=e.deepCopy(s)).father=t.guid,t.props.children.push(i)}}else{var i,s=e.props.getPropsByName(n);t.props.children=t.props.children||[],(i=e.deepCopy(s)).father=t.guid,t.props.children.push(i),e.props.instance.props.children.push(i)}}),r.fromEvent(n,"dragleave").subscribe(function(t){e.render.removeStyle(n,"dashed"),t.preventDefault(),t.stopPropagation()}),r.fromEvent(n,"dragover").subscribe(function(t){e.render.setStyle(n,"dashed","1px lodash red"),t.preventDefault(),t.stopPropagation()})},t.prototype.getInstanceProps=function(t){var e;return this.instances.map(function(r){r.guid===t&&(e=r.props)}),e},t}();v.decorators=[{type:e.Directive,args:[{selector:"[ngComponent]"}]}],v.ctorParameters=function(){return[{type:e.ViewContainerRef},{type:e.TemplateRef},{type:e.IterableDiffers},{type:y},{type:d},{type:g},{type:e.Renderer2},{type:undefined,decorators:[{type:e.Inject,args:[m]}]}]},v.propDecorators={ngComponent:[{type:e.Input}],ngComponentPreview:[{type:e.Input}],ngComponentState:[{type:e.Input}],ngComponentClass:[{type:e.Input}],ngComponentStyle:[{type:e.Input}],ngComponentDrag:[{type:e.Input}],ngComponentDrop:[{type:e.Input}],ngComponentInstance:[{type:e.Input}],ngComponentClick:[{type:e.Input}]};var b=function(){function t(){}return t.prototype.ngOnInit=function(){},t}();b.decorators=[{type:e.Component,args:[{selector:"share-color",template:'\n      <div class="row" [formGroup]="props">\n          <input type="color" placeholder="背景色" [formControlName]="\'background-color\'">\n          <input type="color" placeholder="前景色" [formControlName]="\'color\'">\n      </div>\n    ',styles:["\n      .row {\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-orient: horizontal;\n        -webkit-box-direction: normal;\n            -ms-flex-direction: row;\n                flex-direction: row;\n        width: 100%;\n        margin-top: 5px; }\n        .row input {\n          -webkit-box-flex: 1;\n              -ms-flex: 1;\n                  flex: 1;\n          width: 50%; }\n    "]}]}],b.ctorParameters=function(){return[]},b.propDecorators={props:[{type:e.Input}]};var C=function(){function t(){this.unit=["%","px"]}return t.prototype.ngOnInit=function(){},t}();C.decorators=[{type:e.Component,args:[{selector:"share-size",template:'\n      <div class="row" [formGroup]="props">\n          <input type="number" [attr.placeholder]="\'宽度\'+unit[0]" [formControlName]="\'width.\'+unit[0]">\n          <input type="number" [attr.placeholder]="\'高度\'+unit[1]" [formControlName]="\'height.\'+unit[1]">\n      </div>\n    ',styles:["\n      .row {\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-orient: horizontal;\n        -webkit-box-direction: normal;\n            -ms-flex-direction: row;\n                flex-direction: row;\n        width: 100%;\n        margin-top: 5px; }\n        .row input {\n          -webkit-box-flex: 1;\n              -ms-flex: 1;\n                  flex: 1;\n          width: 50%; }\n    "]}]}],C.ctorParameters=function(){return[]},C.propDecorators={props:[{type:e.Input}],unit:[{type:e.Input}]};var P=function(){function t(){}return t.prototype.ngOnInit=function(){},t.prototype.backgroundImageChange=function(t){this.props.get("background-image").setValue("url("+t.target.value+")")},t}();P.decorators=[{type:e.Component,args:[{selector:"share-background",template:'\n      <div class="row" [formGroup]="props">\n          <input type="text" (change)="backgroundImageChange($event)" [attr.value]="props.get(\'background-image\').value">\n          <input type="text" [formControlName]="\'background-size\'">\n          <input type="text" [formControlName]="\'background-repeat\'">\n          <input type="text" [formControlName]="\'background-position\'">\n      </div>\n    '}]}],P.ctorParameters=function(){return[]},P.propDecorators={props:[{type:e.Input}]};var w=function(){function t(){}return t.prototype.ngOnInit=function(){p.combineLatest(r.fromEvent(this.top.nativeElement,"change"),r.fromEvent(this.right.nativeElement,"change"),r.fromEvent(this.bottom.nativeElement,"change"),r.fromEvent(this.left.nativeElement,"change")).map(function(t){console.log(t)})},t}();w.decorators=[{type:e.Component,args:[{selector:"share-margin",template:'\n      <input type="number" #top>\n      <input type="number" #right>\n      <input type="number" #bottom>\n      <input type="number" #left>\n    '}]}],w.ctorParameters=function(){return[]},w.propDecorators={top:[{type:e.ViewChild,args:["top"]}],right:[{type:e.ViewChild,args:["right"]}],bottom:[{type:e.ViewChild,args:["bottom"]}],left:[{type:e.ViewChild,args:["left"]}],form:[{type:e.Input}]};var x=[b,C,P,w],I=function(){function t(){}return t.forRoot=function(e,r){return void 0===r&&(r=!1),{ngModule:t,providers:[{provide:c,useValue:e,multi:!0},{provide:m,useValue:r}]}},t}();I.decorators=[{type:e.NgModule,args:[{imports:[s.CommonModule,i.ReactiveFormsModule],exports:[v].concat(x),declarations:[v].concat(x),providers:[d,y,g]}]}],I.ctorParameters=function(){return[]},t.IDesignComponentModule=I,t.NgComponentDirective=v,t.DesignApiService=d,t.DesignLibraryService=y,t.DESIGN_LIBRARYS=c,t.DesignPropsService=g,t.DESIGN_COMPONENTS=l,t.ɵe=P,t.ɵc=b,t.ɵf=w,t.ɵb=x,t.ɵd=C,t.ɵa=m,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=meepo-idesign-share.umd.min.js.map
