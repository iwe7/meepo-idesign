!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/observable/fromEvent")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/observable/fromEvent"],t):t(e["meepo-idesign-share"]={},e.ng.core,e.Rx.Observable)}(this,function(e,t,n){"use strict";function o(e){return Array.prototype.concat.apply([],e)}var r=new t.InjectionToken("DESIGN_LIBRARYS"),i=function(){function e(){}return e.prototype.get=function(e){},e.prototype.save=function(e,t){},e}();i.decorators=[{type:t.Injectable}],i.ctorParameters=function(){return[]};var s=new t.InjectionToken("DESIGN_COMPONENTS"),p=function(){function e(e){this.props=[],this.pageProps=[],this.settingProps={},this.historyKey="historyKey",this.historys=[],this.props=o(e);try{this.backToHistory()}catch(t){localStorage.clear()}}return e.prototype.getPropsByName=function(e){var t;return this.props.forEach(function(n){e===n.name&&(t=n)}),t},e.prototype.addPropByName=function(e){var t=this.getPropsByName(e);this.pageProps.push(t),this.updateHistory()},e.prototype.removePropsByUid=function(e){var t;this.pageProps.map(function(n,o){n.uuid===e&&(t=o)}),this.pageProps.splice(t,1),this.updateHistory()},e.prototype.getHistory=function(){var e=localStorage.getItem(this.historyKey);return e?JSON.parse(e):[]},e.prototype.updateHistory=function(){this.historys.unshift({name:(new Date).toISOString(),data:this.pageProps}),this.historys.length>50&&(this.historys=this.historys.splice(this.historys.length,this.historys.length-50)),localStorage.setItem(this.historyKey,JSON.stringify(this.historys))},e.prototype.backToHistory=function(e){void 0===e&&(e=null),e||(e=this.getHistory()[0]),this.pageProps=e.data},e}();p.decorators=[{type:t.Injectable}],p.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[s]}]}]};var a=function(){function e(e){this.components=[],this.components=o(e),console.log("DesignLibraryService",this.components)}return e.prototype.get=function(e){var t;return this.components.map(function(n){n[e]&&(t=n[e])}),t},e}();a.decorators=[{type:t.Injectable}],a.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[r]}]}]};var c=function(){function e(e,t,n,o,r,i){this._viewContainerRef=e,this._template=t,this.differs=n,this.librarys=o,this.props=r,this.render=i,this.instances=[],this.viewContainerRef=e}return e.prototype.ngDoCheck=function(){var e=this;if(this._differ){var t=this._differ.diff(this.ngComponent);t&&t.forEachOperation(function(t,n,o){if(null==t.previousIndex)e.createComponent(t,o);else if(null==o)e._viewContainerRef.remove(n);else{var r=e._viewContainerRef.get(n);e._viewContainerRef.move(r,o)}})}},e.prototype.createComponent=function(e,n){var o=this;try{var r=e.item;if(r){var i=void 0,s=this.librarys.get(r.name);i=this.ngComponentPreview?s.view:s.setting;var p=this.viewContainerRef.parentInjector,a=(this.moduleRef?this.moduleRef.componentFactoryResolver:p.get(t.ComponentFactoryResolver)).resolveComponentFactory(i),c=this.viewContainerRef.createComponent(a,n,p);r.props&&(c.instance.props=r.props),r.state&&(c.instance.state=r.state),c.instance.onClick.subscribe(function(e){o.ngComponentClick&&o.ngComponentClick(r)}),c.instance.setClass(this.ngComponentClass),c.instance.setStyle(this.ngComponentStyle),this.ngComponentDrag&&this.setDrage(c.instance),this.ngComponentDrop&&this.setDrop(c.instance),r.uuid=c.instance.guid;var f=new u(c.instance.guid,r);this.instances.push(f)}}catch(h){console.log((this.ngComponentPreview?"preview":"setting")+" is not fond",e),console.dir(h)}},e.prototype.ngOnChanges=function(e){if(this.viewContainerRef.clear(),"ngComponent"in e){var t=e.ngComponent.currentValue;if(t&&!this._differ)try{this._differ=this.differs.find(t).create()}catch(n){}}},e.prototype.setDrage=function(e){e.setAttribute({draggable:!0});var t=e.ele.nativeElement;n.fromEvent(t,"dragstart").subscribe(function(t){e.guid,t.dataTransfer.setData("name","guid_"+e.guid)}),n.fromEvent(t,"dragend").subscribe(function(e){})},e.prototype.isGuid=function(e){return e.indexOf("guid_")>-1},e.prototype.trimGuid=function(e){return e.replace("guid_","")},e.prototype.setDrop=function(e){var t=this,o=e.ele.nativeElement;n.fromEvent(o,"drop").subscribe(function(n){n.preventDefault(),n.stopPropagation();var o=n.dataTransfer.getData("name"),r=t.trimGuid(o);if(console.log(e,o),t.isGuid(o)){if(r!==e.guid){(i=t.getInstanceProps(r))&&e.props.children.push(i)}}else{var i=t.props.getPropsByName(o);e.props.children=e.props.children||[],e.props.children.push(i)}}),n.fromEvent(o,"dragleave").subscribe(function(e){t.render.removeStyle(o,"dashed"),e.preventDefault(),e.stopPropagation()}),n.fromEvent(o,"dragover").subscribe(function(e){t.render.setStyle(o,"dashed","1px lodash red"),e.preventDefault(),e.stopPropagation()})},e.prototype.getInstanceProps=function(e){var t;return this.instances.map(function(n){n.guid===e&&(t=n.props)}),t},e}();c.decorators=[{type:t.Directive,args:[{selector:"[ngComponent]"}]}],c.ctorParameters=function(){return[{type:t.ViewContainerRef},{type:t.TemplateRef},{type:t.IterableDiffers},{type:a},{type:p},{type:t.Renderer2}]},c.propDecorators={ngComponent:[{type:t.Input}],ngComponentPreview:[{type:t.Input}],ngComponentState:[{type:t.Input}],ngComponentClass:[{type:t.Input}],ngComponentStyle:[{type:t.Input}],ngComponentDrag:[{type:t.Input}],ngComponentDrop:[{type:t.Input}],ngComponentClick:[{type:t.Input}]};var u=function(){return function(e,t){this.guid=e,this.props=t}}(),f=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:r,useValue:t,multi:!0}]}},e}();f.decorators=[{type:t.NgModule,args:[{imports:[],exports:[c],declarations:[c],providers:[i,a,p]}]}],f.ctorParameters=function(){return[]},e.IDesignComponentModule=f,e.NgComponentDirective=c,e.InstanceComponent=u,e.DesignApiService=i,e.DesignLibraryService=a,e.DESIGN_LIBRARYS=r,e.DesignPropsService=p,e.DESIGN_COMPONENTS=s,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=meepo-idesign-share.umd.min.js.map
